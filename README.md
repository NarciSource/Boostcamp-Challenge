# ë¶€ìŠ¤íŠ¸ìº í”„ ì±Œë¦°ì§€ Day11. íƒë°° ì‹œë®¬ë ˆì´í„°

## ë‚˜ë§Œì˜ ì²´í¬í¬ì¸íŠ¸

-   [x] ê°ì²´ ì‹ë³„
-   [x] ë™ìž‘ì˜ˆì‹œ í•´ì„ ðŸ˜’
-   [x] ì‹œí€€ìŠ¤ ë‹¤ì´ì–´ê·¸ëž¨
-   [x] ìŠˆë„ ì½”ë“œ

### 1ë‹¨ê³„. ì ‘ìˆ˜ ì´ë²¤íŠ¸

-   [x] ì§ì ‘ ìŠ¤ë ˆë“œë¥¼ ë§Œë“¤ë©´ ì•ˆë˜ê³ , Eventë¥¼ ì²˜ë¦¬í•˜ëŠ” ë¹„ë™ê¸° ì´ë²¤íŠ¸ ì²˜ë¦¬í•˜ë„ë¡ êµ¬í˜„í•œë‹¤.

-   [x] _ì ‘ìˆ˜ ê¸°ê³„_(POS)ëŠ” ì ‘ìˆ˜ë¥¼ **ì—°ì†í•´ì„œ** ë°›ì„ ìˆ˜ ìžˆë‹¤.

    -   [x] ì ‘ìˆ˜ë¥¼ ë°›ìœ¼ë©´ _ì ‘ìˆ˜ ëŒ€ê¸°í_(Queue)ì— _ì¶”ê°€í•œë‹¤_.

-   [x] ëŒ€ê¸°íì— ë“¤ì–´ìžˆëŠ” ì´ë²¤íŠ¸ë¥¼ êº¼ë‚´ì„œ ì²˜ë¦¬í•˜ëŠ” **ì´ë²¤íŠ¸ ë£¨í¼**(Looper)ë¥¼ ë³„ë„ ëª¨ë“ˆ/ê°ì²´ë¡œ ë¶„ë¦¬í•´ì„œ êµ¬í˜„í•œë‹¤.

-   [x] _ì ‘ìˆ˜ ë§¤ë‹ˆì €_(Manager)ëŠ” **ì£¼ê¸°ì ìœ¼ë¡œ** ì ‘ìˆ˜ ëŒ€ê¸°íì—ì„œ ì´ë²¤íŠ¸ë¥¼ _í™•ì¸í•œë‹¤_.

    -   [x] ì ‘ìˆ˜ ëŒ€ê¸°ê°€ ìžˆì„ ê²½ìš°, *ë¬¼ë¥˜ ì„¼í„° í*ì— ë¬¼í’ˆ ì´ë²¤íŠ¸ë¥¼ _ì „ë‹¬í•œë‹¤_.

    -   [x] í•„ìš”í•˜ë©´ ë§¤ë‹ˆì €(Manager)ë„ ë°°ì†¡ í˜„í™©íŒì„ í‘œì‹œí•  ì´ë²¤íŠ¸ë¥¼ ì „ë‹¬í•  ìˆ˜ ìžˆë‹¤.

-   [x] *ìž‘ì—…ìž*ëŠ” ë¬¼í’ˆ ë¶„ë¥˜í•˜ê¸° ì‹œìž‘í•  ë•Œì™€ ëë‚  ë•Œ ë§ˆë‹¤ ì´ë²¤íŠ¸ë¥¼ ë°œìƒí•œë‹¤.

    -   ë¬¼ë¥˜ ì„¼í„°ë³„ ìž‘ì—…ìžëŠ” í•œ ë²ˆì— 1ê°œ ë¬¼í’ˆì„ ë¶„ë¥˜í•  ìˆ˜ ìžˆë‹¤ê³  ê°€ì •í•œë‹¤.

-   [x] *ë°°ë‹¬ ê¸°ì‚¬*ë„ ë¬¼í’ˆì„ ë°°ì†¡ ì‹œìž‘í•  ë•Œì™€ ëë‚  ë•Œ ë§ˆë‹¤ ì´ë²¤íŠ¸ë¥¼ ë°œìƒí•œë‹¤.

    -   ë°°ë‹¬ ê¸°ì‚¬ëŠ” í•œ ë²ˆì— 1ê°œê¹Œì§€ ë¬¼í’ˆë§Œ ë°°ë‹¬í•  ìˆ˜ ìžˆë‹¤ê³  ê°€ì •í•œë‹¤.

    -   ë°°ë‹¬ì€ ê±°ë¦¬ì™€ ìƒê´€ì—†ì´ ë™ì¼í•˜ê²Œ 10ë¶„ì”© ê±¸ë¦°ë‹¤ê³  ê°€ì •í•œë‹¤.

-   [x] _íƒë°° í˜„í™©íŒ_(DashBoard)ëŠ” ì „ì²´ íƒë°° í˜„í™©ì„ ì£¼ê¸°ì ìœ¼ë¡œ í™”ë©´ì— ì¶œë ¥í•œë‹¤.

    -   [x] ì ‘ìˆ˜í•œ ë¬¼í’ˆì— ëŒ€í•´ ëŒ€ê¸°ì¤‘/ë¶„ë¥˜ì¤‘/ë°°ì†¡ì¤‘/ë°°ì†¡ì™„ë£Œ ìƒíƒœë¥¼ í‘œì‹œí•œë‹¤.

### 2ë‹¨ê³„. ë©€í‹°ì„¼í„° ë°°ì†¡ ì‹œë®¬ë ˆì´ì…˜

-   [x] í”„ë¡œê·¸ëž¨ì„ ì‹œìž‘í•  ë•Œ ìž‘ì—…ìžì™€ ë°°ë‹¬ ê¸°ì‚¬ ì¸ì›ìˆ˜ë¥¼ ì§€ì •í•˜ë„ë¡ êµ¬í˜„í•œë‹¤.

    -   [x] í”„ë¡œê·¸ëž¨ì´ ì‹œìž‘í•˜ë©´ ìž‘ì—…ìžì™€ ë°°ë‹¬ ê¸°ì‚¬ê°€ ëª‡ ëª…ì¸ì§€ ì¶œë ¥í•œë‹¤.

-   [x] ì ‘ìˆ˜ë¥¼ í•  ë•Œë§ˆë‹¤ ì ‘ìˆ˜í•œ ê³ ê°ì„ êµ¬ë¶„í•´ì„œ í•œêº¼ë²ˆì— ì ‘ìˆ˜í•œ ë¬¼í’ˆë“¤ì„ êµ¬ë¶„í•´ì„œ ì•Œê³  ìžˆì–´ì•¼ í•œë‹¤.

-   [x] ë§¤ë‹ˆì €(Manager)ëŠ” ì ‘ìˆ˜/ë°°ë‹¬ ëŒ€ê¸°íì—ì„œ ì´ë²¤íŠ¸ë¥¼ ë°›ëŠ”ë‹¤.

    -   [x] ì ‘ìˆ˜ ëŒ€ê¸°ê°€ ìžˆì„ ê²½ìš° ìž‘ì—…ì´ ë¬¼ë¥˜ì„¼í„°ë³„ë¡œ ë¬¼í’ˆì´ ì ì€ ê³³ìœ¼ë¡œ ì´ë²¤íŠ¸ë¥¼ ì „ë‹¬í•œë‹¤. ë¬¼ë¥˜ì„¼í„°ë³„ ë¶„ë¥˜ ëŒ€ê¸° ëª©ë¡ì„ ê´€ë¦¬í•´ì•¼ í•œë‹¤.

    -   [x] ë¬¼ë¥˜ì„¼í„° ì§€ì •ì´ ëë‚œ ë¬¼í’ˆì— ëŒ€í•´ ë°°ë‹¬ ê°€ëŠ¥í•œ ê¸°ì‚¬ì—ê²Œ ìž‘ì—… ì´ë²¤íŠ¸ë¥¼ ì „ë‹¬í•œë‹¤. ëŒ€ê¸°ì¤‘ì¸ ë°°ë‹¬ ê¸°ì‚¬ ëª©ë¡ì„ ê´€ë¦¬í•´ì•¼ í•œë‹¤.

-   [x] ì´ì œ ë¬¼ë¥˜ì„¼í„°ëŠ” 4ê³³ì´ ìžˆë‹¤ê³  ê°€ì •í•˜ê³ , ìž‘ì—…ìžëŠ” í•œ ë²ˆì— 2ê°œ ë¬¼í’ˆê¹Œì§€ ë™ì‹œì— ë¶„ë¥˜í•  ìˆ˜ ìžˆë‹¤ê³  ê°€ì •í•œë‹¤.

-   [x] ë¬¼ë¥˜ì„¼í„°ë³„ë¡œ ìž‘ì—…ìžê°€ 3ëª… ì´ìƒì¼ ê²½ìš°, ê°ìž ë‹´ë‹¹í•˜ëŠ” ë¬¼í’ˆì„ ë¶„ë°°í•˜ëŠ” ë°©ì‹ì„ êµ¬í˜„í•œë‹¤.

    -   [x] ëª¨ë“  ìž‘ì—…ìžê°€ ì†Œí˜•,ì¤‘í˜•,ëŒ€í˜•ì„ ëª¨ë‘ ì²˜ë¦¬í•˜ì§€ ì•Šê³ , ìž‘ì—…ìžë³„ë¡œ ì ì–´ë„ 1ê°œëŠ” ì „ë‹´í•˜ëŠ” ë¬¼í’ˆì´ ìžˆì–´ì•¼ í•œë‹¤.

-   [x] í˜„í™©íŒì—ëŠ” ì ‘ìˆ˜í•œ ê³ ê°ë³„ë¡œ ì ‘ìˆ˜í•œ ë¬¼í’ˆ í˜„í™©ê³¼ ë°°ë‹¬ í˜„í™©ì„ êµ¬ë¶„í•´ì„œ í‘œì‹œí•´ì•¼ í•œë‹¤.

    -   [x] ë¬¼í’ˆ ë¶„ë¥˜ê°€ ë˜ê±°ë‚˜ ë°°ë‹¬ì´ ì™„ë£Œë˜ë©´ í˜„í™©íŒì´ ë°”ë€Œì–´ì•¼ í•œë‹¤.
    -   [x] ê³ ê°ì´ ì ‘ìˆ˜í•œ ëª¨ë“  ë¬¼í’ˆ ë°°ì†¡ì´ ì™„ì„±ë˜ë©´ ê°ìž ìžê¸°ë§Œì˜ ë°©ì‹ìœ¼ë¡œ íŠ¹ë³„í•˜ê²Œ(?) í‘œì‹œí•´ì„œ ì¶œë ¥í•œë‹¤.

-   [x] ëª¨ë“  ë¬¼í’ˆì´ ë°°ë‹¬ë˜ê³ ë‚˜ì„œ 3ì´ˆ ë™ì•ˆ ì£¼ë¬¸ì´ ì—†ìœ¼ë©´ í”„ë¡œê·¸ëž¨ì„ ì¢…ë£Œí•œë‹¤.

## ë¬¸ì œ í•´ê²° ê³¼ì •

### ê°ì²´ ì‹ë³„

-   EventLooper ì´ë²¤íŠ¸ ë£¨í¼
-   Manager ì ‘ìˆ˜ ë§¤ë‹ˆì € - ì´ë²¤íŠ¸ ê´€ë¦¬
-   POS ì ‘ìˆ˜ê¸°ê³„ - ì´ë²¤íŠ¸ ë“±ë¡
-   ClassifyWorker ë¶„ë¥˜ ìž‘ì—…ìž
-   DeliveryWorker ë°°ë‹¬ ê¸°ì‚¬
-   DashBoard í˜„í™©íŒ
-   LogisticsCenter ë¬¼ë¥˜ ì„¼í„°

### ì‹œí€€ìŠ¤ ë‹¤ì´ì–´ê·¸ëž¨

```mermaid
sequenceDiagram
    participant POS
    participant Manager
    participant ready_queue
    participant active_queue
    participant completed_queue
    participant ClassifyWorker
    participant DeliveryWorker
    note over ready_queue, completed_queue: EventLooper

    loop watcher
        Manager->>POS: check()
        alt If parcel exists
            POS->>Manager: transfer()
            Manager->>ready_queue: enqueue()
        end
    end

    loop parcel classify
        ready_queue->>active_queue: active()
        active_queue->>ClassifyWorker: unclassified_parcel
        ClassifyWorker->>ClassifyWorker: classify()
        ClassifyWorker->>ready_queue: classified_parcel
    end

    loop parcel deliver
        ready_queue->>active_queue: active()
        active_queue->>DeliveryWorker: delivery_parcel
        DeliveryWorker->>DeliveryWorker: delivery()
        DeliveryWorker->>completed_queue: delivered_parcel
    end
```

### pseudo code

```js
POS
    ready_queue <- input parcel

Manager
    machines: POSes

    function watcher
        while parcel <- POS.transfer
            min of logisticsCenter.enqueue()

LogisticsCenter
    classify_workers: subscribers
    delivery_workers: subscribers

EventLoops
    ready_queue
    active_queue
    completed_queue

    loop
        completed_queue <= active_queue <= ready_queue

```

### ê²°ê³¼

![simulate](https://gist.github.com/user-attachments/assets/49be3ffe-05ec-48be-8876-a721a2ea3ffa)

## í•™ìŠµ ë©”ëª¨

-   [Event Loop](https://developer.mozilla.org/ko/docs/Web/JavaScript/Event_loop)

## ê°œì„  ì‚¬í•­ ì²´í¬í¬ì¸íŠ¸

-   [x] ìž…ë ¥ ëª…ë ¹ ì²˜ë¦¬ ë¶€ë¶„ &rarr; ë°›ì•„ì˜¨ ìž…ë ¥ì— ëŒ€í•´ ìž˜ëª»ëœ ìž…ë ¥ì— ëŒ€í•œ ì²˜ë¦¬
-   [x] parcel_typeì´ ì½”ë“œì˜ì˜ í™•ìž¥ì„±, ìž¬ì‚¬ìš©ì„ ê³ ë ¤í•˜ì—¬ input ë©”ì†Œë“œ ë°–ì— ì„ ì–¸ë˜ë©´ ì¢‹ì„ ê²ƒ ê°™ì•„ìš”! POS.ts
-   [x] ë§¤ì§ ë„˜ë²„ ì •ë¦¬
-   [x] ì½”ë“œ ìŠ¤ë‹ˆí• ì •ë¦¬
-   [x] allocate_worker í”Œëž˜ê·¸ íŒ¨í„´ì—ì„œ í”Œëž˜ê·¸ë¥¼ ë¬¸ìžì—´ &rarr; íƒ€ìž…
